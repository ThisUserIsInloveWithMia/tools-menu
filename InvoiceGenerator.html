<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Receipt Generator â€” King's Bakeshop</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#fff; }
    .receipt-card { border:1px solid #ccc; margin:10px; padding:10px; border-radius:8px; }
    .receipt-header { font-weight:bold; margin-bottom:5px; }
    .summary-card { margin:20px; padding:15px; background:#f85a40; color:#fff; border-radius:8px; text-align:center; font-weight:bold; }
    .row-line { margin-left:10px; }
    table.receipt-table { width:100%; border-collapse:collapse; margin-top:10px; }
    table.receipt-table th, table.receipt-table td { border:1px solid #ddd; padding:5px; text-align:left; }
    table.receipt-table th { background:#f0f0f0; }
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; }
    .modal-content { background:#fff; padding:20px; border-radius:8px; max-width:400px; width:90%; }
    .btn { background:#f85a40; border:none; color:#fff; padding:10px 20px; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Receipt Generator â€” King's Bakeshop</h1>
  <div>
    Starting Receipt #: <input id="startNumber" type="number"><br>
    Gross Target (â‚±): <input id="grossTarget" type="number" step="0.01"><br>
    Approx. Receipt Count: <input id="approxCount" type="number"><br>
    <button onclick="generate()">Generate Receipts</button>
  </div>
  <div id="receipts"></div>

  <!-- What's New Modal -->
  <div id="whatsNewModal" class="modal">
    <div class="modal-content">
      <h3>What's new?</h3>
      <ul>
        <li>â€¢ Common bug fixes</li>
        <ul>
          <li>- Too many product lines produce</li>
          <li>- Over shooting of total</li>
          <li>- Cake receipts discrepancy</li>
        </ul>
        <li>â€¢ Added a main menu</li>
        <li>â€¢ Dark / Light mode added</li>
      </ul>
      <button onclick="closeWhatsNew()" class="btn">Cool!</button>
    </div>
  </div>

  <script>
    const breads = {
      "Cream Bread":75, "Cheese Roll":37, "Coffee Bavarian Bun":48,
      "Yema Krema":99, "Dulce de Ube":135, "Pizza Dog":58,
      "Special Pandesal (x9)":58, "Cheese Bites":72,
      "Malunggay Tuna":45, "Coco Cluster (x6)":59, "Pineapple Delight":32,
      "Hopia Ube":168
    };
    const cakes = { "Fluffy Chiffon":180, "Chiffon Cake":180 };

    function money(v){ return "â‚±"+v.toFixed(2); }
    function vatFromGross(g){ return +(g*12/112).toFixed(2); }
    function netFromGross(g){ return +(g - vatFromGross(g)).toFixed(2); }

    function addItem(arr, qty, name, price){
      let found = arr.find(it => it[1]===name && it[2]===price);
      if(found){
        found[0]+=qty;
      } else {
        if(arr.length < 5){
          arr.push([qty,name,price]);
        } else {
          let pick = arr[Math.floor(Math.random()*arr.length)];
          pick[0]+=qty;
        }
      }
    }

    function generate(){
      const start  = +document.getElementById("startNumber").value;
      const target = +document.getElementById("grossTarget").value;
      const approx = +document.getElementById("approxCount").value;
      if(!start||!target||!approx){ alert("Fill in all inputs"); return; }

      const breadsArr = Object.entries(breads);
      const cakesArr = Object.entries(cakes);

      let receipts=[], running=0, current=start;

      function randomBreadReceipt(rem){
        let k=Math.floor(Math.random()*6)+1;
        let pool=[...breadsArr]; pool.sort(()=>Math.random()-0.5);
        let items=[], gross=0;
        for(let i=0;i<pool.length&&items.length<k;i++){
          let [n,p]=pool[i];
          let qty=Math.floor(Math.random()*3)+1;
          let cost=p*qty;
          if(gross+cost<=rem){
            addItem(items,qty,n,p);
            gross+=cost;
          }
        }
        return {items,gross};
      }

      function makeCakeReceipt(){
        let [n,p]=cakesArr[Math.floor(Math.random()*cakesArr.length)];
        return {items:[[1,n,p]],gross:p,cake:true};
      }

      while(running<target-200 && receipts.length<approx-1){
        let rem=target-running;
        let cand=Math.random()<0.2?makeCakeReceipt():randomBreadReceipt(rem);
        if(cand.items.length && running+cand.gross<=target){
          receipts.push({...cand,num:current++});
          running+=cand.gross;
        } else break;
      }

      let remainder=+(target-running).toFixed(2);
      if(remainder<90||remainder>110){ remainder=100; }

      let finalItems=[[1,"Rounding Breads",remainder]];
      receipts.push({num:current,items:finalItems,gross:remainder,rounding:true});
      running=+(running+remainder).toFixed(2);

      let diff=+(running-target).toFixed(2);
      if(diff!==0){
        let roundingReceipt=receipts[receipts.length-1];
        let newGross=+(roundingReceipt.items[0][2]-diff).toFixed(2);
        if(newGross<0) newGross=0;
        roundingReceipt.items=[[1,"Rounding Breads",newGross]];
        roundingReceipt.gross=newGross;
        running=+(running-diff).toFixed(2);
      }

      const wrap=document.getElementById("receipts"); wrap.innerHTML="";
      receipts.forEach((r,idx)=>{
        const card=document.createElement("div");
        card.className="receipt-card";
        const header=document.createElement("div");
        header.className="receipt-header";
        header.textContent=r.rounding?`ðŸ”¶ Receipt ${r.num} (Rounding)`: `Receipt ${r.num}${r.cake?" â€” Cake Only":""}`;
        card.appendChild(header);
        let tbodyHTML="";
        r.items.forEach(it=>{
          const row=document.createElement("div");
          row.className="row-line";
          let lineTotal = it[0]*it[2]; // recalc every time
          row.textContent=`${it[0]} Ã— ${it[1]} â€“ â‚±${it[2]} = â‚±${lineTotal.toFixed(2)}`;
          card.appendChild(row);
          tbodyHTML+=`<tr><td>${it[0]}</td><td>${it[1]}</td><td>${money(it[2])}</td><td>${money(lineTotal)}</td></tr>`;
        });
        const vat=vatFromGross(r.gross), net=netFromGross(r.gross);
        card.innerHTML+=`<div class="row-line">Less: VAT (12%) = ${money(vat)}</div>`;
        card.innerHTML+=`<div class="row-line">Net of VAT = ${money(net)}</div>`;
        card.innerHTML+=`<div class="row-line"><b>Gross Total: ${money(r.gross)}</b></div>`;
        wrap.appendChild(card);
      });
      const diffFinal=+(running-target).toFixed(2);
      const summary=document.createElement("div");
      summary.className="summary-card";
      summary.innerHTML=`PROJECT SUMMARY<br>Start: ${start} â€“ End: ${current}<br>Receipts: ${receipts.length}<br>Target Gross: ${money(target)}<br>Grand Gross: ${money(running)}<br>Difference: ${diffFinal>0?"+":""}${money(diffFinal)}`;
      wrap.appendChild(summary);
    }

    function showWhatsNew(){ document.getElementById("whatsNewModal").style.display="flex"; }
    function closeWhatsNew(){ document.getElementById("whatsNewModal").style.display="none"; }
    window.addEventListener("load", function(){ showWhatsNew(); });
  </script>
</body>
</html>
