<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple POS — Final Layout and Features</title>
  <style>
    /* --- General Styles --- */
    :root{--accent:#07689f; --remove-color: #d9534f; --commit-color: #28a745; --download-color: #f0ad4e;}
    /* FIX: Background changed to lighter #fafafa */
    body{font-family:Inter,Segoe UI,Arial;margin:0;background:#fafafa;color:#222} 
    .wrap{max-width:1100px;margin:24px auto;padding:20px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,.06)}
    #transactionLogContainer { margin-top: 24px; }
    h1{margin:0 0 12px;font-size:20px}
    h2{margin-top: 0; font-size: 18px;}
    .layout{display:grid;grid-template-columns:1fr 420px;gap:16px}
    .top-controls{display:flex;justify-content:space-between;gap:16px;margin-bottom:16px;}
    .controls{display:flex;gap:8px;align-items:center}
    input,select,button{padding:8px;border-radius:8px;border:1px solid #e3e7ea;font-size:14px}
    select{min-width:260px}
    
    /* Default button style */
    button{background:var(--accent);color:#fff;border:none;cursor:pointer}
    .remove-btn{background:var(--remove-color);padding:4px 8px;border-radius:6px;font-size:13px;color:#fff;}
    #commitBtn { background: var(--commit-color); }
    #downloadBtn { background: var(--download-color); } 

    /* Tables */
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #eef2f4;text-align:left}
    tfoot td{font-weight:700}
    .right{text-align:right}
    .small{font-size:13px;color:#666}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .details-table{width: 400px; margin-top: 0; background: #f9f9f9; border-radius: 8px;}
    .details-table td:first-child{font-weight: 500;}
    .details-table td{padding: 6px 10px; border: none;}
    
    #logTable th, #logTable td {
        padding: 10px;
        font-size: 14px;
        text-align: left;
        border-bottom: 1px solid #e3e7ea;
    }
    #logTable th {
        background: #f1f4f8;
        font-weight: 600;
        border-top: 1px solid #e3e7ea;
    }
    .txn-items-cell { 
        cursor: pointer; 
        color: var(--accent);
        text-decoration: underline;
    }
    .log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    /* --- CRITICAL FIX FOR QUICK LIST BUTTONS --- */
    #quickList button {
        background: #fff; /* Override default button background */
        color: #222; 
        border: 1px solid #ddd;
        white-space: normal; /* Allows text to wrap */
        height: auto;
        min-height: 50px; 
        line-height: 1.2;
        text-align: left;
        /* Ensures the two inner <div>s stack vertically */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        font-size: 13px; 
        padding: 6px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Simple POS — Cashier and Transaction Details</h1>
      
      <div class="top-controls">
        <div style="flex:1; max-width: 400px;">
          <div class="small">Cashier Name</div>
          <input id="cashierName" placeholder="Enter Cashier Name..." style="width: 100%; margin-top: 6px;" />
        </div>
        
        <table class="details-table" id="detailsTable">
            <tbody>
                <tr><td>Cashier</td><td id="displayCashier">N/A</td></tr>
                <tr><td>Transaction ID</td><td id="displayTxnId">TID-0001</td></tr>
                <tr><td>Date/Time</td><td id="displayDateTime"></td></tr>
            </tbody>
        </table>
      </div>

      <div class="layout">
        <div>
          <div class="small">Search / Select product</div>
          <div class="controls" style="margin-top:6px">
            <input id="search" placeholder="Search product name..." style="flex:1" />
            <select id="productSelect"></select>
            <input id="qty" type="number" value="1" min="1" style="width:84px" />
            <button id="addBtn">Add</button>
          </div>

          <table id="cartTable">
            <thead>
              <tr><th>Item</th><th class="right">Price</th><th class="right">Qty</th><th class="right">Total</th><th></th></tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr><td colspan="3" class="right">Total Due</td><td class="right" id="subtotal"></td><td></td></tr>
            </tfoot>
          </table>

          <div class="actions">
            <button id="clear">Clear</button>
            <button id="print">Print Receipt</button>
            <button id="commitBtn">Commit Sale</button>
          </div>
        </div>

        <div>
          <div class="small">Quick product list (click to add)</div>
          <div id="quickList" style="margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:6px;max-height:520px;overflow:auto;padding:8px;border:1px dashed #e6eef3;border-radius:8px"></div>
        </div>
      </div>
    </div>
    
    <div class="card" id="transactionLogContainer">
        <div class="log-header">
            <h2>Transaction History Log</h2>
            <button id="downloadBtn">Download Sales Report (Excel)</button>
        </div>
        <table id="logTable">
            <thead>
                <tr>
                    <th>TXN ID</th>
                    <th>Date</th>
                    <th>Cashier</th>
                    <th class="right">Total</th>
                    <th>Items</th>
                </tr>
            </thead>
            <tbody id="logTbody">
                <tr><td colspan="5" style="text-align: center; color: #666;">No transactions committed yet.</td></tr>
            </tbody>
        </table>
    </div>
  </div>

  <script>
    // --- SETUP CONSTANTS & FORMATTERS ---

    const formatter = new Intl.NumberFormat('en-PH', {
      style: 'currency',
      currency: 'PHP',
      minimumFractionDigits: 2,
    });
    
    const dateTimeFormatter = new Intl.DateTimeFormat('en-PH', { 
        dateStyle: 'short', 
        timeStyle: 'medium' 
    });
    
    const timeFormatter = new Intl.DateTimeFormat('en-PH', { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit'
    });
    
    let transactionCount = 1;
    function generateTxnId() {
        return 'TID-' + String(transactionCount).padStart(4, '0');
    }

    function formatCurrency(amount) {
        return formatter.format(amount);
    }
    
    const committedTransactions = [];

    // --- PRODUCT DATA (From your previous list) ---
    const productText = `Asado roll	55
Asado square	188
Baked chicken empanada	65
Braided ham	47
Brown sugar raisin	125
Cheese bites	75
DOUBLE CHEESE BREAD X4	75
Cheese roll	37
Coffee bavarian bun	52
Coffee roti roll	35
Cream Bread	80
Creamy enzaimada	37
Custard cream bun	38
Enzaimada bites	88
Enzaimada rolls	155
Flossy meat roll	55
Four Seasons	38
Garlic bread Butter Toast	69
HAM & QUEZO	47
Ham & Cheese Roll	59
Hongkong milk bread	65
Hotdog with cheese	47
Malunggay chiz pandesal	69
Malunggay tuna	46
Milky baby pandesal	75
Milky ube roll	70	
Mongo loaf	65
Mongo roll	19
Coco cluster x6	65
Pandecoco	18
Pineapple delight	32
Hopia Mongo	168
Hopia Ube	168
Hopia Container	5
Mochi Bread x6	128
Special mongo bun	62
Special pandesal x9	62
Ube enzaimada single	47
UBE MARBLE loaf	140
Ube munchies	85
Ube quezo pandesal	125
Ube stick	27
Wheat bread	75
Cheese stick bread	45
Pizzadog	59
Volcanic Cheese Melt	172
Pizza round	52
BABY ENZAIMADA	49
Spicy Chicken Floss	59
RAISIN & WALNUT SOUR DOUGH	69
Malunggay Pandesal x9	69
Premium Cheeserolls	168
DULCE de UBE	108
CHEESY FLOSSY BAR	108
Double Munchies	55
Bavarian Munchies	55
Raisin Minis	55
Cinnamon rolls	55	
SET1 BM5	119
SET2 CE5	139
SET 3 CE2,BMP3	129
SET 4 MR2, US2, FS1	119
SET5 MR2, BS1, CRR2	129
SET6 PAD2, BM1, PCO2	119
SET7 CCR2, BM1, PCO2	119	
CHEESE BITES BOX	260
CINNAMON X6	290
DOUBLE CHEESE ROLL (BOX)	190
ENZAIMADA TRIO X6	260
ENZAIMADA TRIO X9	398
MILKY CRÈAM CHEESE ROLL	260
MINI CREAM CHEESE ENZAIMADAX12	290
Paborito Breads x10	190
SAVORY BUNS x6	210
SAVORY BUNS x9	295
SIGNATURE ENZAIMADA X6	225
SPANISH COFFEE BUN	175	
Banana loaf (New Improved)	188
Banana slice	45
Cheezee mamon /pc	49
Chiffon cake	68
Choco vanilla	42
Flossy chiffon x4	110
Milky egg pie	49
Mini cakes x12	230
Mocha vanilla	42
Sossy flossy roll	110
Yema Krema	90
CHIFFON CLOUD	142
LECHE FLAN CAKE	195
Mini Jelly Roll	110
PREMIUM TAISAN BAR	165	
Cheese pie	29
Choco crinkles	58
S'mores fudge x8	198
Fudge brownies x12	125
Fudge brownies Single	29
Macaroons	98	
Egg Pie Whole	375
Box Of Pianono x20	290	
CHOCO CARAMEL Affordable	575
Choco Dream Affordable	595
Choco Fantasy 8X11	795
Choco Fantasy Affordable	550
DOLCE DE LECHE 8X11	795
DOLCE DE LECHE Affordable	575
FLAVOR PARADE RECTANGLE	985
Ivory Bloom Affordable	495
Kitkat Mousse Affordable	695
Mango Supreme Affordable	595
Mocha Drip Affordable	595
MOCHALICIOUS 8X11	795
Mochalicious Affordable	575
Nutella Affordable	695
SALTED CARAMEL WALNUT	695
The Duet (Choco Mocha)	595
Ube Halaya Affordable	575
UBE LECHE FLAN Affordable	595
CHOCO FUDGE	550
BERRY BLACK FOREST	695
MOCHA VANILLA BLISS	495
YEMA DELIGHT	550
MINI HAM & CHEESE 	35
cinnamon rolls single	65
SNOW CREAM	58
WHITE CHOCO ALMOND	59
3 MEATS BUN	99	
THERMAL ICED TEA	45
THERMAL BAG MEDIUM	165
THERMAL BAG LARGE	35
ICED TEA	165
ALMOND JELLY	75
ASSTD CANDY 	70
ASSTD.CHIPS ( 7 SEAS )	175
ASSTD LOLLIPOP	7
ASSTD MUSHROOM	135	
ASSTD POLVORON X12	85
ASSTD BISCUIT	55
BANANA CHIPS BIG	115
BARQUILLOS	78
BARQUILLOS TUB	97
BIG OVEN BROWNIES	78
CANDY CANE PER PACK	60
CARP SARAP	52
CHARACTER SURPRISE	10
CHICHA CORN	62
CHICHA POP	40
CHICHA POP CON.	70
CHOCO BISCUIT (ORIGO)	35
CHOCO BISCUIT STICK	38
CHOCO NIPS	90
CHUNKY PEANUT BUTTER	165
CLASSIC Biscocho	115
CREAMY APAS	68
DABOY BITE SIZE	240
DABOY CHICHARON	85
DABOY TRAY BACKFAT	265
DAILY NUT	48
DAILYPLUS ASST.	135
DARK/RED VELVET CRINKLES	298
DILIS CRISPY / SPICY	68
DILIS MIXED	98
DINOSAUR EGG BIG	75
DINOSAUR EGG SMALL	35
DRIED FRUIT	220
EGG COINS	145
EGG CRACKERS	110
ESPASOL	140
EVERYDAY MIX NUTS	168
FISH CRACKER SMALL	25
FLAVORED GARLIC PEANUT	195
GARLIC PEANUT POUCH	36
GOLD COINS POUCH	100
GUMMY CANDY ASSTD. POUCH	48
HAMBURGER SQUISHY	50
HOPIA KING	50
JELLY BEANS	45
JUMBO EGG	50
JUMBO WHIRL LOLLIPOP	15
Kiamoy Pouch	80
HAMBURGER SQUISHY	50
KROPECK SHRIMP	48
LECHE FLAN	160
LENGUA	20
MACARONI CRACKERS	25
MIXE)D NUTS POUCH	36
MUNCH ASSRTED	98
NACHOS ASSRTED	120
ORGANIC EGG	365
OGOY	25
OGOY STICK	60
OTAP	25
OTAP NEW	68
PABORITA SMALL	60
PACENCIA WHITE	72
party lollipop	10
PEANUT BAR	58
PEANUT NOUGAT	82
PEANUT POUCH	85
PILIPIT BIG X10	95
POTATO CHIPS	79
RAINBOW MALLOWS	80
RED VELVET BROWNIE	85
ROASTED CASHEW	100
SECO VARIETY	68
SHRIMP CRACKERS	18
SUPER EGG	75
SMALL MANTOU	100
SPECIAL BISCOCHO	65
SPECIAL MONGO BEAN	165
SPECIAL PABORITA	110
SQUASH SEEDS	40
SWEET TAMARIND CANDY	97
TAMARIND CANDY	62
TEA EGG	30
TIKOY HOPIA	116
TOAST GARLIC /LESS SUGAR	75
TOASTED MAMON	125
TOFU ASSORTED FLV.	82
TORONES POUCH	60
TORONES TUB	80
URARO	30
YEMA MINI PACK	48
YEMA TOWER	10
PANCAKE SANDWICHES	140
ADOBO PEANUT 	38
SPICY CHICKEN FLOSS	195
CRISPY PORK FLOSS	195
MACHANG CHICK N PORK	140
MACHANG DOUBLE PORK	150
RICE CRACKERS	98
KIKIAM	320
MISUA	250
DIOK PIT HE (CAM)	320
3n1 KAKANIN	130
ESPASOL	140
KUTSINTA	130
PUTO PAO	145
SUMAN PINIPIG SMALL	150	
PUTO BIG	100
PUTO BIGAS	80
PUTO SMALL	65
KING'S BOTTLED WATER	20
CALAMANSI JUICE (Island)	39
COKE in can	43
GATORADE 500ML	53
HERBAL TEA TAMARIND	48
NATURAL SOYA	35
NESTEA	37
NESTLE CHUCKIE 37
PINEAPPLE JUICE	46
SELECTA MOO	37
SIP PURIFIED WATER 1000ml	28
SMART C+	42
VITAMILK	38
ZAMBO CALAMANSI JUICE	39
ZESTO BIG	15	
ETHLY ALCOHOL	295
EMPANADA BOX	20
EMPANADA CONTAINER	4
FOUNTAIN CANDLE	30
GOLD NUMBER CANDLE	30
MILK TEA CUPS 16 oz	68
MILK TEA CUPS 22 oz	88
PREMIUM CAKE TOPPER60	60
SPIRAL CANDLE /PC	55
STANDARD CAKETOPPER40	40
TEA EGG CONTAINER	5
3n1 Coffee 25
Coke Mismo 28
`;

    // parse product text into objects
    const products = productText.split('\n').map(line => {
      const parts = line.split('\t');
      const name = parts[0].trim();
      const price = parseFloat((parts[1]||'0').toString().replace(/[^0-9.\-]/g, '')) || 0;
      return { name, price };
    }).filter(p=>p.name);

    // --- DOM REFS ---
    const select = document.getElementById('productSelect');
    const search = document.getElementById('search');
    const qtyInput = document.getElementById('qty');
    const addBtn = document.getElementById('addBtn');
    const cartTbody = document.querySelector('#cartTable tbody');
    const subtotalEl = document.getElementById('subtotal');
    const quickList = document.getElementById('quickList');
    const commitBtn = document.getElementById('commitBtn'); 
    const downloadBtn = document.getElementById('downloadBtn'); 

    const cashierInput = document.getElementById('cashierName');
    const displayCashierEl = document.getElementById('displayCashier');
    const displayTxnIdEl = document.getElementById('displayTxnId');
    const displayDateTimeEl = document.getElementById('displayDateTime');
    const logTbody = document.getElementById('logTbody');
    
    let cart = [];

    // --- FUNCTIONALITY ---

    function updateDetails() {
        const cashierName = cashierInput.value.trim() || 'N/A';
        displayCashierEl.textContent = cashierName;
        displayTxnIdEl.textContent = generateTxnId();
        displayDateTimeEl.textContent = dateTimeFormatter.format(new Date());
    }

    function populateSelect(list){
      select.innerHTML = '';
      list.forEach((p,i)=>{
        const opt = document.createElement('option');
        opt.value = i; 
        opt.textContent = `${p.name} — ₱${p.price.toFixed(2)}`; 
        select.appendChild(opt);
      });
    }

    // *** FINALIZED QUICK BUTTON RENDER FIX (Using DIVs for stable stacking) ***
    function renderQuick(list){
      quickList.innerHTML = '';
      list.forEach((p,i)=>{
        const btn = document.createElement('button');
        
        // Use innerHTML with two DIVs to ensure clean stacking and wrapping (due to flex column)
        btn.innerHTML = `
          <div style="font-size: 14px; text-align: left;">${p.name}</div>
          <div style="font-weight: bold; font-size: 15px; color: var(--accent); margin-top: 2px;">₱${p.price.toFixed(2)}</div>
        `;
        
        btn.title = 'Click to add 1';
        btn.onclick = ()=>{ addToCart(p,1); };
        quickList.appendChild(btn);
      });
    }


    function renderTransactionLog() {
        logTbody.innerHTML = ''; 

        if (committedTransactions.length === 0) {
            logTbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">No transactions committed yet.</td></tr>';
            return;
        }

        [...committedTransactions].reverse().forEach((txn, index) => {
            const tr = document.createElement('tr');
            const originalIndex = committedTransactions.length - 1 - index; 
            tr.innerHTML = `
                <td>${txn.txnId}</td>
                <td>${txn.dateTime.toLocaleDateString()} ${timeFormatter.format(txn.dateTime)}</td>
                <td>${txn.cashier}</td>
                <td class="right">${formatCurrency(txn.total)}</td>
                <td class="txn-items-cell" data-index="${originalIndex}">View (${txn.items.length})</td>
            `;
            logTbody.appendChild(tr);
        });
        
        logTbody.querySelectorAll('.txn-items-cell').forEach(cell => {
            cell.onclick = function() {
                showTransactionDetails(+this.dataset.index);
            };
        });
    }

    function showTransactionDetails(index) {
        const txn = committedTransactions[index];
        const itemDetails = txn.items.map(item => 
            `${item.qty}x ${item.name} (${formatCurrency(item.price)} each)`
        ).join('\n');

        alert(`--- Transaction ${txn.txnId} Details ---\n\nCashier: ${txn.cashier}\nDate: ${txn.dateTime.toLocaleDateString()} ${timeFormatter.format(txn.dateTime)}\nTotal: ${formatCurrency(txn.total)}\n\nItems:\n${itemDetails}`);
    }

    function addToCart(product, qty){
      qty = Number(qty)||1;
      const existing = cart.find(c=>c.name===product.name);
      if(existing) existing.qty += qty;
      else cart.push({ ...product, qty });
      renderCart();
    }

    function renderCart(){
      cartTbody.innerHTML='';
      let subtotal = 0;

      cart.forEach((item,idx)=>{
        const tr = document.createElement('tr');
        const total = item.price * item.qty;
        subtotal += total;

        tr.innerHTML = `<td>${item.name}</td><td class="right">${formatCurrency(item.price)}</td><td class="right">${item.qty}</td><td class="right">${formatCurrency(total)}</td><td class="right"><button class="remove-btn" data-idx="${idx}">Remove</button></td>`;
        cartTbody.appendChild(tr);
      });

      subtotalEl.textContent = formatCurrency(subtotal);

      cartTbody.querySelectorAll('button').forEach(btn=>btn.onclick=function(){ const i=+this.dataset.idx; cart.splice(i,1); renderCart(); });
    }

    function commitTransaction() {
        if (cart.length === 0) {
            alert("The cart is empty. Nothing to commit.");
            return;
        }

        const subtotal = cart.reduce((s,i)=>s + i.price*i.qty,0);
        
        const transactionRecord = {
            txnId: displayTxnIdEl.textContent,
            cashier: cashierInput.value.trim() || 'N/A',
            dateTime: new Date(),
            items: JSON.parse(JSON.stringify(cart)), 
            total: subtotal
        };
        committedTransactions.push(transactionRecord);

        renderTransactionLog(); 
        alert(`Transaction ${transactionRecord.txnId} committed successfully!\nTotal Sale: ${formatCurrency(subtotal)}`);
        
        cart = [];
        renderCart();
        transactionCount++; 
        updateDetails(); 
    }
    
    function getAggregatedSales() {
        const aggregated = {}; 

        committedTransactions.forEach(txn => {
            txn.items.forEach(item => {
                const name = item.name;
                const qty = item.qty;
                const price = item.price;
                
                if (aggregated[name]) {
                    aggregated[name].qty += qty;
                } else {
                    aggregated[name] = { qty: qty, price: price };
                }
            });
        });

        return aggregated;
    }

    function downloadSalesData() {
        if (committedTransactions.length === 0) {
            alert("No committed transactions to download.");
            return;
        }

        const aggregatedData = getAggregatedSales();
        
        let csv = "Product Name,Total Quantity Sold,Unit Price (PHP),Total Revenue (PHP)\n";
        
        for (const name in aggregatedData) {
            const data = aggregatedData[name];
            const revenue = data.qty * data.price;

            const line = [
                `"${name}"`, 
                data.qty, 
                data.price.toFixed(2),
                revenue.toFixed(2)
            ].join(",");

            csv += line + "\n";
        }
        
        const grandTotal = committedTransactions.reduce((sum, txn) => sum + txn.total, 0);
        csv += `Grand Total,,,,${grandTotal.toFixed(2)}\n`;


        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        
        link.setAttribute("href", url);
        link.setAttribute("download", `Sales_Report_${new Date().toISOString().slice(0, 10)}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert(`Sales report downloaded as Sales_Report_${new Date().toISOString().slice(0, 10)}.csv`);
    }

    // --- EVENT LISTENERS & INITIALIZATION ---

    populateSelect(products);
    renderQuick(products.slice(0,80)); 
    renderCart(); 
    updateDetails(); 
    renderTransactionLog(); 

    cashierInput.addEventListener('input', updateDetails);
    
    search.addEventListener('input',()=>{
      const q = search.value.trim().toLowerCase();
      const filtered = products.filter(p=>p.name.toLowerCase().includes(q));
      populateSelect(filtered);
      renderQuick(filtered.slice(0,80));
    });

    addBtn.addEventListener('click',()=>{
      if (select.selectedIndex === -1) {
        alert("Please select a product.");
        return;
      }
      
      const optionText = select.options[select.selectedIndex].textContent;
      const matchName = optionText.substring(0, optionText.lastIndexOf(' — ₱')); 
      const prod = products.find(p=>p.name===matchName);
      
      const qty = Number(qtyInput.value);
      if (qty <= 0 || isNaN(qty)) {
          alert("Please enter a valid quantity greater than 0.");
          qtyInput.value = 1;
          return;
      }

      if(prod) {
        addToCart(prod, qty);
      } else {
        alert("Error: Product not found.");
      }
    });

    document.getElementById('clear').addEventListener('click',()=>{ 
        if(confirm('Are you sure you want to clear the entire cart? This will NOT save the transaction?')) {
            cart = []; 
            renderCart();
        }
    });

    commitBtn.addEventListener('click', commitTransaction);
    downloadBtn.addEventListener('click', downloadSalesData);

    // print receipt (simple)
    document.getElementById('print').addEventListener('click',()=>{
      if (cart.length === 0) {
        alert("Cannot print an empty receipt.");
        return;
      }
      const receipt = generateReceipt();
      const w = window.open('', '_blank');
      w.document.write(receipt);
      w.document.close();
      w.print();
    });

    function generateReceipt(){
      const subtotal = cart.reduce((s,i)=>s + i.price*i.qty,0);
      const cashier = cashierInput.value.trim() || 'N/A';
      const txnId = displayTxnIdEl.textContent;
      const dateTime = displayDateTimeEl.textContent;

      const lines = cart.map(i=>`<tr><td>${i.name}</td><td class="right">${i.qty} x ${formatCurrency(i.price)}</td><td class="right">${formatCurrency(i.qty*i.price)}</td></tr>`).join('');
      
      const html = `<!doctype html><html><head><meta charset="utf-8"><title>Receipt</title><style>body{font-family:Arial;padding:16px;max-width:300px}table{width:100%;border-collapse:collapse}td{padding:6px 0;border-bottom:1px dashed #ddd} .right{text-align:right;} .total{font-weight:bold;}</style></head><body><h2>Receipt</h2>
      <p style="font-size: small;">
          Cashier: ${cashier}<br>
          TXN ID: ${txnId}<br>
          Date: ${dateTime}
      </p>
      <table>${lines}</table><hr>
      <table>
        <tr><td class="total">TOTAL DUE:</td><td class="right total">${formatCurrency(subtotal)}</td></tr>
      </table>
      <p style="text-align:center;font-size:small;margin-top:20px;">Thank you for your business!</p>
      </body></html>`;
      return html;
    }

  </script>
</body>
</h
